{% extends "base.html" %}

{% block title %}Challenges - CoachSmart ğŸ†{% endblock %}

{% block content %}
<style>
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
}

@keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
    50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
}

.challenge-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: 1px solid rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.challenge-card:hover {
    transform: translateY(-5px);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
    box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
}

.challenge-card.gold {
    border: 2px solid rgba(255, 215, 0, 0.5);
    animation: glow 2s ease-in-out infinite;
}

.floating {
    animation: float 3s ease-in-out infinite;
}

.pulsing {
    animation: pulse 2s ease-in-out infinite;
}

.gradient-text {
    background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.join-btn {
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.join-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.join-btn:hover::before {
    left: 100%;
}

.join-btn:hover {
    transform: translateY(-3px) scale(1.05);
}

.progress-ring {
    transform: rotate(-90deg);
}

.tab-btn {
    transition: all 0.3s ease;
}

.tab-btn:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
}

.filter-btn {
    transition: all 0.3s ease;
}

.filter-btn:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
}

.filter-btn.active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
}

.tab-btn.active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
    border-color: rgba(102, 126, 234, 0.5);
}
</style>

<div class="container mx-auto p-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-5xl font-black mb-4 gradient-text floating">ğŸ† CHALLENGES</h1>
        <p class="text-xl text-gray-300">Compete, achieve, and win rewards! ğŸ¯</p>
    </div>

    <!-- Challenge Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="challenge-card rounded-2xl p-4 text-center">
            <span class="text-3xl floating">ğŸ”¥</span>
            <p class="text-2xl font-black text-orange-300 mt-2 pulsing">{{ active_challenges|length }}</p>
            <p class="text-gray-400 text-sm">Active</p>
        </div>
        <div class="challenge-card rounded-2xl p-4 text-center">
            <span class="text-3xl floating" style="animation-delay: 0.2s;">âœ…</span>
            <p class="text-2xl font-black text-green-300 mt-2 pulsing" style="animation-delay: 0.2s;">{{ completed_challenges|length }}</p>
            <p class="text-gray-400 text-sm">Completed</p>
        </div>
        <div class="challenge-card rounded-2xl p-4 text-center">
            <span class="text-3xl floating" style="animation-delay: 0.4s;">ğŸ…</span>
            <p class="text-2xl font-black text-yellow-300 mt-2 pulsing" style="animation-delay: 0.4s;">{{ gold_medals }}</p>
            <p class="text-gray-400 text-sm">Gold Medals</p>
        </div>
        <div class="challenge-card rounded-2xl p-4 text-center">
            <span class="text-3xl floating" style="animation-delay: 0.6s;">ğŸ’</span>
            <p class="text-2xl font-black text-purple-300 mt-2 pulsing" style="animation-delay: 0.6s;">{{ user_stats.total_points if user_stats else 0 }}</p>
            <p class="text-gray-400 text-sm">Total Points</p>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex flex-wrap gap-3 mb-6">
        <button class="tab-btn active px-4 py-2 rounded-xl border border-purple-500/30 text-white font-black" data-tab="active">
            ğŸ”¥ Active
        </button>
        <button class="tab-btn px-4 py-2 rounded-xl border border-purple-500/30 text-gray-300 font-black hover:text-white" data-tab="available">
            ğŸ“‹ Available
        </button>
        <button class="tab-btn px-4 py-2 rounded-xl border border-purple-500/30 text-gray-300 font-black hover:text-white" data-tab="completed">
            âœ… Completed
        </button>
        <button class="tab-btn px-4 py-2 rounded-xl border border-purple-500/30 text-gray-300 font-black hover:text-white" data-tab="leaderboard">
            ğŸ† Leaderboard
        </button>
    </div>

    <!-- Challenge Type Filters (for Available Challenges) -->
    <div id="challenge-filters" class="flex flex-wrap gap-2 mb-6" style="display: none;">
        <button class="filter-btn active px-3 py-1 rounded-lg border border-purple-500/30 text-white text-sm font-black" data-type="all">
            All Types
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="streak">
            ğŸ”¥ Streaks
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="workout_count">
            ğŸ’ª Workouts
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="distance">
            ğŸƒ Distance
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="time">
            â±ï¸ Time
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="calories">
            ğŸ”¥ Calories
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="points">
            ğŸ’ Points
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="challenge_count">
            ğŸ¯ Challenges
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="variety">
            ğŸŒŸ Variety
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="ultimate">
            ğŸ‘‘ Ultimate
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="personal_record">
            âš¡ Records
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-gray-300 text-sm font-black hover:text-white" data-type="weekly_goal">
            ğŸ“… Weekly
        </button>
        <button class="filter-btn px-3 py-1 rounded-lg border border-purple-500/30 text-yellow-300 text-sm font-black hover:text-white" data-type="gold">
            ğŸ† Gold Only
        </button>
    </div>

    <!-- Active Challenges -->
    <h2 class="text-2xl font-black text-white mb-6">ğŸ”¥ Active Challenges</h2>
    {% if active_challenges %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            {% for user_challenge, challenge in active_challenges %}
                {% set progress_percent = (user_challenge.current_progress / challenge.target_value * 100) if challenge.target_value > 0 else 0 %}
                <div class="challenge-card rounded-2xl p-6 {% if challenge.badge_name == 'gold' %}gold{% endif %}">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            {% if challenge.badge_name == 'gold' %}
                                <span class="inline-block bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-black px-2 py-1 rounded-full mb-1">ğŸ† GOLD</span>
                            {% endif %}
                            <h3 class="text-lg font-black text-orange-300 mb-1">ğŸ”¥ {{ challenge.name }}</h3>
                            <p class="text-gray-300 text-sm">{{ challenge.description }}</p>
                        </div>
                        <div class="text-center">
                            <span class="text-2xl floating">ğŸ¯</span>
                            <p class="text-orange-400 text-sm mt-1">{{ challenge.points_reward }} pts</p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm text-gray-400 mb-1">
                            <span>Progress</span>
                            <span>{{ user_challenge.current_progress }}/{{ challenge.target_value }} 
                            {% if challenge.challenge_type == 'streak' %}days
                            {% elif challenge.challenge_type == 'workout_count' %}workouts
                            {% elif challenge.challenge_type == 'distance' %}km
                            {% elif challenge.challenge_type == 'time' %}minutes
                            {% elif challenge.challenge_type == 'calories' %}calories
                            {% elif challenge.challenge_type == 'points' %}points
                            {% elif challenge.challenge_type == 'challenge_count' %}challenges
                            {% elif challenge.challenge_type == 'variety' %}workouts
                            {% elif challenge.challenge_type == 'ultimate' %}complete
                            {% else %}goals{% endif %}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div class="bg-gradient-to-r from-orange-400 to-red-500 h-3 rounded-full transition-all duration-500" style="--progress-width: {{ progress_percent }}%; width: var(--progress-width)"></div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="text-sm">
                            <span class="text-yellow-300">ğŸ† Reward:</span>
                            <span class="text-gray-300 ml-1">{{ challenge.points_reward }} pts + Badge</span>
                        </div>
                        <div class="text-sm text-gray-400">
                            {% if challenge.challenge_type == 'streak' %}ğŸ“… {{ challenge.target_value }} days{% else %}ğŸ“Š No time limit{% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="challenge-card rounded-2xl p-8 mb-8">
            <div class="text-center">
                <span class="text-5xl mb-4 block">ğŸ¯</span>
                <p class="text-gray-300 font-bold">No active challenges. Join some challenges to start earning rewards!</p>
            </div>
        </div>
    {% endif %}

    <!-- Available Challenges -->
    <h2 class="text-2xl font-black text-white mb-6">ğŸ“‹ Available Challenges</h2>
    {% if available_challenges %}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            {% for challenge in available_challenges %}
                <div class="challenge-card rounded-2xl p-6 {% if challenge.badge_name == 'gold' %}gold{% endif %}" 
                     data-challenge-type="{{ challenge.challenge_type }}"
                     data-is-gold="{{ 'true' if challenge.badge_name == 'gold' else 'false' }}">
                    <div class="text-center mb-4">
                        <span class="text-4xl floating">
                            {% if challenge.badge_name == 'gold' %}ğŸ†
                            {% elif challenge.challenge_type == 'streak' %}ğŸ”¥
                            {% elif challenge.challenge_type == 'workout_count' %}ğŸ’ª
                            {% elif challenge.challenge_type == 'distance' %}ğŸƒ
                            {% elif challenge.challenge_type == 'time' %}â±ï¸
                            {% elif challenge.challenge_type == 'calories' %}ğŸ”¥
                            {% elif challenge.challenge_type == 'points' %}ğŸ’
                            {% elif challenge.challenge_type == 'challenge_count' %}ğŸ¯
                            {% elif challenge.challenge_type == 'variety' %}ğŸŒŸ
                            {% elif challenge.challenge_type == 'ultimate' %}ğŸ‘‘
                            {% elif challenge.challenge_type == 'personal_record' %}âš¡
                            {% elif challenge.challenge_type == 'weekly_goal' %}ğŸ“…
                            {% else %}ğŸ¯{% endif %}
                        </span>
                        <h3 class="text-lg font-black text-green-300 mt-3">{{ challenge.name }}</h3>
                        <p class="text-gray-300 text-sm mt-2">{{ challenge.description }}</p>
                    </div>

                    <div class="text-center mb-4">
                        {% if challenge.badge_name == 'gold' %}
                            <span class="inline-block bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-black px-2 py-1 rounded-full mb-2">ğŸ† GOLD</span>
                        {% endif %}
                        <span class="text-yellow-300">ğŸ† {{ challenge.points_reward }} pts</span>
                    </div>

                    <form action="{{ url_for('join_challenge', challenge_id=challenge.id) }}" method="POST">
                        <button type="submit" class="join-btn w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white font-black py-2 px-4 rounded-xl">
                            JOIN CHALLENGE
                        </button>
                    </form>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="challenge-card rounded-2xl p-8 mb-8">
            <div class="text-center">
                <span class="text-5xl mb-4 block">ğŸ†</span>
                <p class="text-gray-300 font-bold">You've joined all available challenges! Keep working to complete them.</p>
            </div>
        </div>
    {% endif %}

    <!-- Completed Challenges -->
    <h2 class="text-2xl font-black text-white mb-6">âœ… Recently Completed</h2>
    {% if completed_challenges %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for user_challenge, challenge in completed_challenges %}
                <div class="challenge-card rounded-2xl p-6 opacity-75">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-black text-green-300 mb-1">ğŸ† {{ challenge.name }}</h3>
                            <p class="text-gray-300 text-sm">{{ challenge.description }}</p>
                        </div>
                        <div class="text-center">
                            <span class="text-2xl">âœ…</span>
                            <p class="text-green-400 text-sm mt-1">+{{ challenge.points_reward }} pts</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="challenge-card rounded-2xl p-8">
            <div class="text-center">
                <span class="text-5xl mb-4 block">ğŸ†</span>
                <p class="text-gray-300 font-bold">No completed challenges yet. Keep working to earn your first badge!</p>
            </div>
        </div>
    {% endif %}
</div>

<script>
// Tab switching functionality
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const challengeFilters = document.getElementById('challenge-filters');
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    // Tab switching
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all tabs
            tabButtons.forEach(tab => {
                tab.classList.remove('active', 'text-white');
                tab.classList.add('text-gray-300');
            });
            
            // Add active class to clicked tab
            this.classList.add('active', 'text-white');
            this.classList.remove('text-gray-300');
            
            // Show/hide filters based on active tab
            const tabType = this.getAttribute('data-tab');
            if (tabType === 'available') {
                challengeFilters.style.display = 'flex';
            } else {
                challengeFilters.style.display = 'none';
            }
            
            // Here you could add logic to show/hide different content sections
            // For now, we'll just handle the filter visibility
        });
    });
    
    // Filter functionality for available challenges
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all filter buttons
            filterButtons.forEach(filter => {
                filter.classList.remove('active', 'text-white');
                filter.classList.add('text-gray-300');
            });
            
            // Add active class to clicked filter
            this.classList.add('active', 'text-white');
            this.classList.remove('text-gray-300');
            
            // Filter challenges
            const filterType = this.getAttribute('data-type');
            const challengeCards = document.querySelectorAll('.challenge-card[data-challenge-type]');
            
            challengeCards.forEach(card => {
                const challengeType = card.getAttribute('data-challenge-type');
                const isGold = card.getAttribute('data-is-gold') === 'true';
                
                // Show/hide based on filter
                if (filterType === 'all') {
                    card.style.display = 'block';
                } else if (filterType === 'gold') {
                    card.style.display = isGold ? 'block' : 'none';
                } else {
                    card.style.display = challengeType === filterType ? 'block' : 'none';
                }
            });
        });
    });
});
</script>

{% endblock %}
